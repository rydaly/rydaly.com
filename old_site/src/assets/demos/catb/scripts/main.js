"use strict";var catbSettings={queryOptions:{categoryId:0,regionCode:"US",maxResults:10},defaultVoice:null,categories:[],previousVid:"",currentVid:"EFo84MVbVQ8",currentComments:[],isMobile:!0,hasSpeechSynth:!1,setCurrent:function(e){this.previousVid=this.currentVid,this.currentVid=e}};$(document).ready(function(){catbSettings.isMobile=jQuery.browser.mobile,catbSettings.hasSpeechSynth="speechSynthesis"in window,YouTubePlayer.initAPI(),window.onYouTubeIframeAPIReady=function(){YouTubePlayer.initPlayer().then(function(t){gapi.load("client",e)},function(e){console.log("ERROR on player init :: ",e)})};var e=function(){var e=YouTubeData.init(),n=SpeechSynth.init();$.when(e,n).done(function(e,n){Catb.init(),catbSettings.currentVid=CatbRouter.getHash(),YouTubeData.doMainQuery("id"),window.addEventListener("commentsReady",t,!1)})},t=function(e){SpeechSynth.cancelReadback(),CatbRouter.setHash(catbSettings.currentVid),YouTubePlayer.loadVideo(catbSettings.currentVid),window.addEventListener("videoStarted",n,!1)},n=function(e){SpeechSynth.startReadback()}});var Catb=function(){var e={},t=function(){var t=(function(){e.commentsOverlay=$(".comments-overlay"),e.videoOverlay=$(".video-overlay")}(),$(".category-select")),n=$(".menu-toggle-btn"),i=$(".menu"),a=$(".menu-video-search-form"),o=$(".menu-channel-search-form"),s=$(".menu-id-form"),r=$("#menu-id-input"),l=$(".share-btn"),c=function(e){var t=$("<li>").append($("<a>",{class:"menu-category-link",html:e.title}).click(function(){catbSettings.queryOptions.categoryId=e.id,YouTubeData.doMainQuery("category"),u()}));return t},u=function(){i.toggle(),n.toggleClass("menu-open")};$.each(catbSettings.categories,function(){t.append(c(this))}),n.click(function(){u()}),l.click(function(){var e='<form class="modal-copy-form"><input onClick="this.select();" type="text" name="copy_url" value="'+window.location.href+'" size="'+window.location.href.length+'" readonly></form>';Modals.toggleModal("Here ya go, a link to the current video! Share it."+e,"Copy This!","share")}),a.submit(function(e){return e.preventDefault(),u(),YouTubeData.doMainQuery("search"),!1}),o.submit(function(e){return e.preventDefault(),u(),YouTubeData.doMainQuery("channel"),!1}),s.submit(function(e){var t=r.val();return e.preventDefault(),u(),catbSettings.setCurrent(t),Playlist.setCurrent([]),YouTubeData.doMainQuery("id"),!1})};return{init:t,domEls:e}}(),CatbUtil=function(){var e=function(e,t){return Math.random()*(t-e)+e},t=function(e){if(void 0===e)return!1;var t=e.split(" ")[0],n=/^[A-Za-z0-9]*$/,i=new RegExp("([a-zA-Z0-9]+://)?([a-zA-Z0-9_]+:[a-zA-Z0-9_]+@)?([a-zA-Z0-9.-]+\\.[A-Za-z]{2,4})(:[0-9]+)?(/.*)?");return!!t.match(n)&&!i.test(e)};return function(e){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),{randomRange:e,commentFilter:t}}(),Modals=function(){var e=$(".modal"),t=$(".modal-header"),n=$(".modal-words"),i=$(".modal-link-btn"),a=$(".modal-close"),o="Wha-Oh!";i.hide(),a.click(function(){s()});var s=function(a){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;"share"===r?(i.show(),i.attr("href","https://www.youtube.com/watch?v="+catbSettings.currentVid)):i.hide(),t.html(o),s&&t.html(s),n.html(a),"none"===e.css("display")?(e.css({display:"flex","z-index":99}),Catb.domEls.commentsOverlay.css("z-index","-1")):(e.css({display:"none","z-index":-1}),Catb.domEls.commentsOverlay.css("z-index","1"))};return{toggleModal:s}}(),Playlist=function(){var e=[],t=0,n=0,i=!1,a=function(){e.length&&!i&&(t<e.length-1?t++:t=0,e[t].id.videoId?catbSettings.setCurrent(e[t].id.videoId):catbSettings.setCurrent(e[t].id),YouTubeData.doMainQuery("id"))},o=function(){n++,n===e.length&&(i=!0,n=0,Modals.toggleModal("None of the videos in this playlist have comments! BORING. Go ahead and try something else."))},s=function(a){e=a,t=0,n=0,i=!1},r=function(){return e};return{nextVid:a,incrementNoComments:o,setCurrent:s,getCurrent:r}}(),CatbRouter=function(){var e=function(){var e=window.location.hash.split("#")[1];return e&&"undefined"!==e||(e=catbSettings.currentVid),e},t=function(e){console.log("setting hash :: ",e),catbSettings.previousVid!==catbSettings.currentVid&&(window.location.hash="#"+e)};return window.addEventListener("hashchange",function(t){catbSettings.currentVid=e(),t.oldURL!==t.newURL&&YouTubeData.doMainQuery("id")},!1),{setHash:t,getHash:e}}(),YouTubePlayer=function(){var e,t=null,n=new CustomEvent("videoStarted",{detail:""}),i=function(){var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)},a=function(){return new Promise(function(i,a){function s(t){e=$("#player"),catbSettings.isMobile?e.fadeIn("fast"):e.fadeIn("fast"),t.target.setVolume(15),i("YT Player Ready")}function r(e){switch(e.data){case YT.PlayerState.BUFFERING:t.isBuffered=!1;break;case YT.PlayerState.PLAYING:t.isBuffered||(t.isBuffered=!0,o(),window.dispatchEvent(n));break;case YT.PlayerState.ENDED:e.target.seekTo(0)}}function l(e){a("YT Player Failed")}t=new YT.Player("player",{width:"1280",height:"720",videoId:catbSettings.currentVid,playerVars:{controls:0,disablekb:1,enablejsapi:1,fs:0,loop:1,modestbranding:1,playsinline:1,showinfo:0,showsearch:0},events:{onReady:s,onStateChange:r,onError:l}})})},o=function(){e.addClass("show").removeClass("hide"),Catb.domEls.commentsOverlay.addClass("show").removeClass("hide"),Catb.domEls.videoOverlay.addClass("hide").removeClass("show")},s=function(){e.addClass("hide").removeClass("show"),Catb.domEls.commentsOverlay.addClass("hide").removeClass("show"),Catb.domEls.videoOverlay.addClass("show").removeClass("hide")},r=function(e){t.loadVideoById(e)},l=function(){t.playVideo()},c=function(){t.stopVideo()};return{initAPI:i,initPlayer:a,hidePlayer:s,showPlayer:o,loadVideo:r,playVideo:l,stopVideo:c}}(),SpeechSynth=function(){var e=["Albert","Bad News","Bahh","Bells","Boing","Bubbles","Cellos","Deranged","Good News","Hysterical","Pipe Organ","Trinoids","Whisper","Zarvox"],t=$(".comment"),n=$(".comment-content"),i=$(".comment-details"),a=$(".comment-username"),o=$(".comment-avatar"),s=$(".comment-is-reply"),r=$(".comment-in-reply-to"),l=$(".comment-likes"),c=null,u=null,d=[],m=0,p=function(t){return!(e.indexOf(t)>-1)},h=function(){var e=$.Deferred();return catbSettings.hasSpeechSynth?window.speechSynthesis.onvoiceschanged=function(){for(var t=window.speechSynthesis.getVoices(),n=0;n<t.length;n++)t[n].default&&(catbSettings.defaultVoice=t[n]),"en-US"===t[n].lang&&p(t[n].name)&&d.push(t[n]);e.resolve("SpeechSynth :: Voices Ready")}:(catbSettings.isMobile?Modals.toggleModal("Support for speech sythesis is spotty on mobile devices. Try using a more modern browser or come back on your desktop. Feel free to continue, but you won't be getting a complete experience."):Modals.toggleModal("Looks like your browser doesn't support speech synthesis. Time for an upgrade! Feel free to continue, but you'll basically just be seeing a video player!"),e.reject("SpeechSynth :: Voices Not Avaiable")),e.promise()},g=function(){v()},y=function(){window.speechSynthesis.cancel(),clearTimeout(c),clearTimeout(u),c=null,u=null,m=0},v=function e(){if(m<catbSettings.currentComments.length){window.utterances=[];var p=catbSettings.currentComments[m].text,h=catbSettings.currentComments[m].avatar,g=catbSettings.currentComments[m].username,y=catbSettings.currentComments[m].isReply,v=catbSettings.currentComments[m].inReplyTo,b=catbSettings.currentComments[m].likeCount,f=1===b?" like":" likes",w=2e3,C=new SpeechSynthesisUtterance(p);utterances.push(C),n.html(p),a.html(g),l.html(b+f),o.attr("src",h),y?(i.addClass("is-reply"),r.html("<span>in reply to: </span>"+v),s.show(),r.show()):(i.removeClass("is-reply"),r.html(""),s.hide(),r.hide()),t.removeClass("hide").addClass("show"),C.voice=C.text.length>200?catbSettings.defaultVoice:d[Math.floor(Math.random()*d.length)],C.volume=2,C.rate=CatbUtil.randomRange(1,1.2),C.pitch=CatbUtil.randomRange(1,1.5),speechSynthesis.speak(C),C.onend=function(n){u=setTimeout(function(){t.addClass("hide").removeClass("show")},w),c=setTimeout(function(){e()},w+1500),m++},C.onerror=function(t){m++,e()}}else{if(t.addClass("hide").removeClass("show"),!Playlist.getCurrent().length&&!catbSettings.currentComments.length)return;Playlist.getCurrent().length?Playlist.nextVid():(m=0,e())}};return{init:h,startReadback:g,cancelReadback:y}}(),YouTubeData=function(){var e=$(".vid-title"),t=$(".vid-uploader"),n=$(".vid-stats-views"),i=$(".vid-stats-likes"),a=$(".vid-stats-dislikes"),o=function(){var e=$.Deferred();return gapi.client.init({apiKey:"AIzaSyClXp7mtJlsoJZASUbnugAykmUD8ww_v0c"}).then(function(){gapi.client.request({path:"https://www.googleapis.com/youtube/v3/videoCategories?part=snippet&regionCode=US"}).then(function(t){for(var n=t.result.items,i=0,a=0;a<n.length;a++)n[a].snippet.assignable&&(catbSettings.categories[i]={id:n[a].id,title:n[a].snippet.title},i++);e.resolve("Categories Ready")})},function(t){console.log("error :: "+t.result.error.message),e.reject("Categories Error")}),e.promise()},s=function(o){function s(s){var r=s.result.items[0],l=r?r.snippet:null,c=r?r.statistics:null;if(!r)return Modals.toggleModal(p),void SpeechSynth.cancelReadback();if(!r.status.embeddable||"public"!==r.status.privacyStatus)return void(Playlist.getCurrent().length?Playlist.nextVid():Modals.toggleModal("That video is not public or the owner has disabled embedding. LAME. Go ahead and try something else!"));switch(e.html(l.title),t.html("Uploaded by <span>"+l.channelTitle+"</span>"),n.html(c.viewCount+" Views"),i.html('<i class="fa fa-thumbs-up" aria-hidden="true"></i> '+c.likeCount),a.html('<i class="fa fa-thumbs-down" aria-hidden="true"></i> '+c.dislikeCount),o){case"search":case"channel":catbSettings.queryOptions.categoryId=null;break;case"id":case"category":catbSettings.currentVid=r.id}m().then(function(e){window.dispatchEvent(h)})}var p,h=new CustomEvent("commentsReady",{detail:catbSettings.currentVid});switch(YouTubePlayer.hidePlayer(),SpeechSynth.cancelReadback(),o){case"search":r().then(function(e){return 0===e.result.items.length?void Modals.toggleModal("No match for your video search! You're gonna have to try something else."):(Playlist.setCurrent(e.result.items),catbSettings.setCurrent(Playlist.getCurrent()[0].id.videoId),void l().then(function(e){s(e)}))}),p="Looks like that query returned an empty set. Try something else!";break;case"id":l().then(function(e){s(e)}),p="Looks like that YouTube ID didn't match anything. Check the ID and try again!";break;case"category":c().then(function(e){e.result.items.length&&(Playlist.setCurrent(e.result.items),catbSettings.setCurrent(Playlist.getCurrent()[0].id.videoId)),s(e)}),p="Looks like that category returned an empty set. Try something else!";break;case"channel":u().then(function(e){if(0===e.result.items.length)return void Modals.toggleModal("No match for your channel search! You're gonna have to try something else.");var t=e.result.items[0].id.channelId;d(t).then(function(e){return e.result.items.length?(Playlist.setCurrent(e.result.items),catbSettings.setCurrent(Playlist.getCurrent()[0].id.videoId),void l().then(function(e){s(e)})):void Modals.toggleModal("The matched channel returned an empty set! Try something else.")})}),p="Looks like that query returned an empty set. Try something else!"}},r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=""!==e?e:document.getElementById("menu-video-search").value;return gapi.client.request({path:"https://www.googleapis.com/youtube/v3/search?part=snippet&q="+t+"&order=relevance&regionCode="+catbSettings.queryOptions.regionCode+"&relevanceLanguage=en&maxResults="+catbSettings.queryOptions.maxResults+"&type=video&safeSearch=none&videoEmbeddable=true&videoSyndicated=true"})},l=function(){return gapi.client.request({path:"https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics,status&regionCode="+catbSettings.queryOptions.regionCode+"&id="+catbSettings.currentVid})},c=function(){return gapi.client.request({path:"https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics,status&regionCode="+catbSettings.queryOptions.regionCode+"&videoCategoryId="+catbSettings.queryOptions.categoryId+"&maxResults="+catbSettings.queryOptions.maxResults+"&chart=mostPopular"})},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=""!==e?e:document.getElementById("menu-channel-search").value;return gapi.client.request({path:"https://www.googleapis.com/youtube/v3/search?part=snippet&q="+t+"&order=relevance&regionCode="+catbSettings.queryOptions.regionCode+"&relevanceLanguage=en&maxResults="+catbSettings.queryOptions.maxResults+"&type=channel&safeSearch=none"})},d=function(e){return gapi.client.request({path:"https://www.googleapis.com/youtube/v3/search?part=snippet&channelId="+e+"&order=date&relevanceLanguage=en&regionCode="+catbSettings.queryOptions.regionCode+"&maxResults="+catbSettings.queryOptions.maxResults+"&type=video"})},m=function(e){return gapi.client.request({path:"https://www.googleapis.com/youtube/v3/commentThreads?part=snippet,replies&order=relevance&textFormat=plainText&videoId="+catbSettings.currentVid+"&maxResults=50"}).then(function(e){var t=e.result.items;catbSettings.currentComments=[],0===t.length&&(Playlist.getCurrent().length?Playlist.incrementNoComments():Modals.toggleModal("There are no comments on this video! LAME. Go ahead and try something else!"));for(var n=0;n<t.length;n++){var i=t[n].snippet.topLevelComment.snippet.authorDisplayName;if(CatbUtil.commentFilter(t[n].snippet.topLevelComment.snippet.textDisplay)&&(catbSettings.currentComments.push({text:t[n].snippet.topLevelComment.snippet.textDisplay,isReply:!1,inReplyTo:null,username:i,canRate:t[n].snippet.topLevelComment.snippet.canRate,likeCount:t[n].snippet.topLevelComment.snippet.likeCount,avatar:t[n].snippet.topLevelComment.snippet.authorProfileImageUrl}),void 0!==t[n].replies&&t[n].replies.comments.length>0))for(var a=0;a<t[n].replies.comments.length;a++)CatbUtil.commentFilter(t[n].replies.comments[a].snippet.textDisplay)&&catbSettings.currentComments.push({text:t[n].replies.comments[a].snippet.textDisplay,isReply:!0,inReplyTo:i,canRate:t[n].replies.comments[a].snippet.canRate,likeCount:t[n].replies.comments[a].snippet.likeCount,username:t[n].replies.comments[a].snippet.authorDisplayName,avatar:t[n].replies.comments[a].snippet.authorProfileImageUrl})}},function(e){403===e.status&&(Playlist.getCurrent().length?(Playlist.incrementNoComments(),Playlist.nextVid()):Modals.toggleModal("Comments are disabled on this video. LAME. Go ahead and try something else!"))})};return{init:o,doMainQuery:s}}();